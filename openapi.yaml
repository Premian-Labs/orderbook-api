openapi: 3.1.0
info:
  title: Premia Orderbook Open API (OpenAPI 3.0)
  description: Premia containerised API for decentralised orderbook trading, position, and account management.
  license:
    name: Attribution-NonCommercial 3.0
    url: https://creativecommons.org/licenses/by-nc/3.0
  version: 1.0.0
paths:
  /orderbook/quotes:
    post:
      summary: Publishes option quote(s) on-chain and into the orderbook. Please note there is no gas that is paid to
        publish quotes. Deadline is the number of seconds the order is valid for. Price is normalized.  For calls, 
        price is denominated in the base token (ie 0.13 WETH), and for puts price is in denominated in the 
        quote token but normalized using strike. For example, a put price of 0.13 => (234 USDC price / 1800 Strike ) 
        is equivalent to 234 USDC if the strike is 1800.
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/PublishQuotesRequest'
        required: true
      responses:
        '200':
          description: Quote exists
          content:
            application/json:
              schema:
                type: object
                properties:
                  failed:
                    type: array
                    items:
                      type: object
                      properties:
                        reason:
                          type: string
                          enum:
                            - 'Quote deadline is invalid (cannot be less than 60 sec)'
                            - 'Failed to fetch pool address'
                            - QuoteOBExpired
                            - QuoteOBCancelled
                            - QuoteOBOverfilled
                            - OutOfBoundsPrice
                            - InvalidQuoteOBTaker
                            - InvalidQuoteOBSignature
                            - InvalidAssetUpdate
                            - InsufficientCollateralAllowance
                            - InsufficientCollateralBalance
                            - InsufficientLongBalance
                            - InsufficientShortBalance
                        quote:
                          $ref: '#/components/schemas/ReturnedOrderbookQuote'
                  exists:
                    type: array
                    items:
                        $ref: '#/components/schemas/ReturnedOrderbookQuote'
        '201':
          description: Quote created
          content:
            application/json:
              schema:
                type: object
                properties:
                  created:
                    type: array
                    items:
                      $ref: '#/components/schemas/ReturnedOrderbookQuote'
                  failed:
                    type: array
                    items:
                      type: object
                      properties:
                        reason:
                          type: string
                          enum:
                            - 'Quote deadline is invalid (cannot be less than 60 sec)'
                            - 'Failed to fetch pool address'
                            - QuoteOBExpired
                            - QuoteOBCancelled
                            - QuoteOBOverfilled
                            - OutOfBoundsPrice
                            - InvalidQuoteOBTaker
                            - InvalidQuoteOBSignature
                            - InvalidAssetUpdate
                            - InsufficientCollateralAllowance
                            - InsufficientCollateralBalance
                            - InsufficientLongBalance
                            - InsufficientShortBalance
                        quote:
                          $ref: '#/components/schemas/ReturnedOrderbookQuote'
                  exists:
                    type: array
                    items:
                      $ref: '#/components/schemas/ReturnedOrderbookQuote'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref:  '#/components/schemas/ValidationError'
        '401':
          description: Not authorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthError'
      security:
        - api_key:
            - api
    patch:
      summary: Used to fill quote(s).  Only the size and quoteId for each quote are required. All quoteIds are 
        returned either as 'success' or 'failed'. Each limit order that is trying to be filled is an "all or nothing"
        attempt.
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/FillQuotesRequest'
        required: true
      responses:
        '200':
          description: Quotes filled
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: array
                    items:
                      type: string
                      description: filled quote ids
                      pattern: "[a-fA-F0-9]{64}"
                      example: ba638...fb25e
                  failed:
                    type: array
                    items:
                      type: string
                      description: failed to fill quote ids
                      pattern: "[a-fA-F0-9]{64}"
                      example: ba638...fb25e
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '401':
          description: Not authorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthError'
      security:
        - api_key:
            - api
    delete:
      summary: Deletes the quote(s) from the orderbook that have not exceeded their deadline.  Please note that 
        orders that have surpassed their deadline do NOT need to be cancelled.  They are automatically removed from
        the orderbook and are unfillable on-chain. Cancelling orders does incur on-chain gas fees.
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/DeleteQuotesRequest'
        required: true
      responses:
        '200':
          description: Quote cancelled
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: array
                    items:
                      type: string
                      pattern: '[a-fA-F0-9]{64}$'
                      example: ba638...fb25e
                  failed:
                    type: array
                    items:
                      type: string
                      pattern: '[a-fA-F0-9]{64}$'
                      example: ba638...fb25e
                  omitted:
                    type: array
                    items:
                      type: string
                      pattern: '[a-fA-F0-9]{64}$'
                      example: ba638...fb25e
        '400':
          description: Invalid parameters supplied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '401':
          description: Not authorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthError'
      security:
        - api_key:
            - api
    get:
      summary: Get all quotes for a specific option up to a specified size/qty.   All orders will be ranked from best
        to worst according to price. Please note that this will not show the full state of the orderbook if the total
        market liquidity is greater than the size specified.
      parameters:
        - name: base
          in: query
          required: true
          description: base token symbol (ie WETH)
          schema:
            type: string
            pattern: ^testWETH$|^WETH$|^WBTC$|^PREMIA$|^LINK$|^USDC$|^DAI$|^ARB$
            example: WETH
        - name: quote
          in: query
          required: true
          description: quote token symbol (ie USDC)
          schema:
            type: string
            pattern: ^testWETH$|^WETH$|^WBTC$|^PREMIA$|^LINK$|^USDC$|^DAI$|^ARB$
            example: USDC
        - name: expiration
          in: query
          required: true
          description: option expiration (ie 03NOV23)
          schema:
            type: string
            pattern: ^\d\d\w\w\w\d\d$
            example: 03NOV23
        - name: strike
          in: query
          required: true
          description: option strike (ie 1800)
          schema:
            type: number
            minimum: 0
            example: 1800
        - name: type
          in: query
          description: C or P
          required: true
          schema:
            type: string
            pattern: ^C$|^P$
            example: P
        - name: size
          in: query
          description: number of contracts (ie 4)
          required: true
          schema:
            type: number
            minimum: 0
            example: 3
        - name: side
          in: query
          description: orderbook side (ie bid)
          required: true
          schema:
            type: string
            pattern: "^bid$|^ask$"
            example: bid
        - name: provider
          in: query
          description: unique address of the provider (maker)
          required: false
          schema:
            type: string
            pattern: "^0x[a-fA-F0-9]{40}$"
            example: ba638...fb25e
        - name: taker
          in: query
          description: unique address of the taker (only for rfq quotes)
          required: false
          schema:
            type: string
            pattern: "^0x[a-fA-F0-9]{40}$"
            example: ba638...fb25e
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ReturnedOrderbookQuote'
        '400':
          description: Invalid parameters supplied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '401':
          description: Not authorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthError'
      security:
        - api_key:
            - api
  /orderbook/orders:
    get:
      summary: Gets quote(s) by quoteId(s).  Note that a max of 25 quoteIds can be queried in a single request. The 
        query param should be a key:value object with quoteIds as the key and an array of quoteIds as the value.
      parameters:
        - name: quoteIds
          in: query
          required: true
          description:  "quoteIds: [ba638...fb25e]"
          schema:
            quoteIds:
              type: array
              items:
                type: string
                pattern: '[a-fA-F0-9]{64}$'
                example: ba638...fb25e
              minItems: 1
              maxItems: 25
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ReturnedOrderbookQuote'
        '400':
          description: Invalid parameters supplied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '401':
          description: Not authorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthError'
      security:
        - api_key:
            - api
  /pool/settle:
    post:
      summary: Settles all short positions in each specified option in the request.
      requestBody:
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/PositionsRequestParams'
        required: true
      responses:
        '200':
          description: Positions settled
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: array
                    items:
                      $ref: '#/components/schemas/Option'
                  failed:
                    type: array
                    items:
                      $ref: '#/components/schemas/FailedOptions'
        '400':
          description: Invalid parameters supplied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '401':
          description: Not authorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthError'
      security:
        - api_key:
            - api
  /pool/exercise:
    post:
      summary: Exercises all long positions in each specified option in the request. Please note that there is a fee 
        to exercise options.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PositionsRequestParams'
        required: true
      responses:
        '200':
          description: Positions exercised
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: array
                    items:
                      $ref: '#/components/schemas/Option'
                  failed:
                    type: array
                    items:
                      $ref: '#/components/schemas/FailedOptions'
        '400':
          description: Invalid parameters supplied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '401':
          description: Not authorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthError'
      security:
        - api_key:
            - api
  /pool/annihilate:
    post:
      summary: Annihilates all long/short positions that offset in each specified option in the request. Please note 
        that it should be rare to need this endpoint when using only the orderbook. This is more applicable when 
        there is peer to peer transfers or account consolidations (transactions that do not go through the orderbook).
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/PositionsRequestParams'
        required: true
      responses:
        '200':
          description: Positions annihilated
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: array
                    items:
                      $ref: '#/components/schemas/Option'
                  failed:
                    type: array
                    items:
                      $ref: '#/components/schemas/FailedOptions'
        '400':
          description: Invalid parameters supplied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '401':
          description: Not authorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthError'
      security:
        - api_key:
            - api
  /account/collateral_approval:
    post:
      summary: Approve collateral for trading.  The `amt` field can be either a number or a string `max`.  Setting 
        the approval to max will ensure no approvals are needed prior to a trade. This may also save gas costs and 
        reduce code complexity.  Alternatively, it is possible to approve only the amount intended to be traded (plus
        trading fees if applicable) for each order quoted or filled.
      requestBody:
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApprovalsRequest'
        required: true
      responses:
        '200':
          description: Approved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: array
                    items:
                      $ref: '#/components/schemas/TokenApproval'
                  failed:
                    type: array
                    items:
                      $ref: '#/components/schemas/FailedApproval'
        '400':
          description: Invalid parameters supplied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
        '401':
          description: Not authorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthError'
      security:
        - api_key:
            - api
  /account/orders:
    get:
      summary: Gets all open quotes.  Any valid orders that are fillable and present in the orderbook for the address
        used for the containerized API will be returned. The address used is the one specified in the .env file.
      responses:
        '200':
          description: Successful operation
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ReturnedOrderbookQuote'
        '401':
          description: Not authorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthError'
      security:
        - api_key:
            - api
  /account/collateral_balances:
    get:
      summary: Checks collateral balance for all tokens that have tradeable option markets.
      responses:
        '200':
          description: Approved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: array
                    items:
                      $ref: '#/components/schemas/TokenBalance'
                  failed:
                    type: array
                    items:
                      type: object
                      properties:
                        failedBalanceQuery:
                          type: string
                        reason:
                          type: string
        '401':
          description: Not authorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthError'
      security:
        - api_key:
            - api
  /account/native_balance:
    get:
      summary: Checks the balance of ETH for the given account specified in the .env file.
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                type: number
                example: 13.4556
        '401':
          description: Not authorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthError'
      security:
        - api_key:
            - api
  /account/option_balances:
    get:
      summary: Checks the balance of all option positions for the given account specified in the .env file.
      responses:
        '200':
          description: Success
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OptionPositions'
        '401':
          description: Not authorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AuthError'
      security:
        - api_key:
            - api
components:
  schemas:
    Option:
      type: object
      properties:
        base:
          type: string
          example: WETH
        quote:
          type: string
          example: USDC
        expiration:
          type: string
          pattern: ^\d\d\w\w\w\d\d$
          example: 03NOV23
        strike:
          type: number
          example: 1700
        type:
          enum:
            - C
            - P
          type: string
          example: P
    NFTBalance:
      type: object
      properties:
        amount:
          type: number
          example: 2.46
        name:
          type: string
          example: WETH-USDC-03NOV2023-1800-P
        token_address:
          type: string
          example: 0x...4cFF2
        exposure:
          type: string
          enum:
            - SHORT
            - LONG
    OptionPositions:
      properties:
        expired:
          items:
            $ref: '#/components/schemas/NFTBalance'
          type: array
        open:
          items:
            $ref: '#/components/schemas/NFTBalance'
          type: array
      type: object
    TokenBalance:
      type: object
      properties:
        balance:
          oneOf:
            - type: string
            - type: number
          example: 2.345
        symbol:
          type: string
          example: WETH
        token_address:
          type: string
          pattern: ^0x[a-fA-F0-9]{40}$
          example: 0x...4cFF2
    TokenApproval:
      type: object
      properties:
        token:
          type: string
          example: WETH
        amt:
          oneOf:
            - type: number
            - type: string
              pattern: ^max$
          example: max
    ReturnedOrderbookQuote:
      required:
        - base
        - quote
        - expiration
        - strike
        - type
        - side
        - size
        - price
        - deadline
      type: object
      properties:
        base:
          type: string
          example: WETH
        quote:
          type: string
          example: USDC
        expiration:
          type: string
          pattern: ^\d\d\w\w\w\d\d$
          example: 03NOV23
        strike:
          type: number
          example: 1700
        type:
          enum:
            - C
            - P
          type: string
          example: P
        side:
          enum:
            - ask
            - bid
          type: string
          example: bid
        size:
          type: number
          example: 3
        price:
          type: number
          example: .15
        deadline:
          type: number
          example: 184
        quoteId:
          type: string
          pattern: '[a-fA-F0-9]{64}$'
          example: ba638...fb25e
        ts:
          type: number
          example: 1698952534
    DeleteQuotesRequest:
      type: object
      properties:
        quoteIds:
          type: array
          items:
            type: string
            pattern: '[a-fA-F0-9]{64}$'
            example: ba638...fb25e
          minItems: 1
      required:
        - quoteIds
    FillQuotesRequest:
      type: object
      properties:
        tradeSize:
          type: number
          minimum: 0
          example: 4
        quoteId:
          type: string
          pattern: '[a-fA-F0-9]{64}$'
          example: ba638...fb25e
      required:
        - tradeSize
        - quoteId
    PositionsRequestParams:
      type: object
      properties:
        base:
          type: string
          example: WETH
        quote:
          type: string
          example: USDC
        expiration:
          type: string
          pattern: ^\d\d\w\w\w\d\d$
          example: 03NOV23
        strike:
          type: number
          example: 1700
        type:
          type: string
          pattern: ^C$|^P$
          example: C
      required:
        - base
        - quote
        - expiration
        - strike
        - type
    ApprovalsRequest:
      type: array
      items:
        type: object
        properties:
          token:
            type: string
            example: WETH
          amt:
            oneOf:
              - type: number
              - type: string
                pattern: ^max$
            example: max
        required:
          - token
          - amt
      minItems: 1
      maxItems: 8
    PublishQuotesRequest:
      type: object
      properties:
        base:
          type: string
          example: WETH
        quote:
          type: string
          example: USDC
        expiration:
          type: string
          pattern: ^\d\d\w\w\w\d\d$
          example: 03NOV23
        strike:
          type: number
          example: 1800
        type:
          type: string
          pattern: ^C$|^P$
          example: P
        side:
          type: string
          pattern: ^bid$|^ask$
          example: bid
        size:
          type: number
          example: 4
        price:
          type: number
          example: .13
        deadline:
          type: integer
          example: 120
        taker:
          type: string
          pattern: ^0x[a-fA-F0-9]{40}$
          example: 0x...4cFF2
      required:
        - base
        - quote
        - expiration
        - strike
        - type
        - side
        - size
        - price
        - deadline
    FailedOptions:
      type: object
      properties:
        failedOption:
          $ref: '#/components/schemas/Option'
        reason:
          type: string
    FailedApproval:
      type: object
      properties:
        failedApproval:
          $ref: '#/components/schemas/TokenApproval'
        reason:
          type: string
      required:
        - failedApproval
        - reason
    AuthError:
      type: object
      properties:
        message:
          type: string
          default: 'Invalid API key'
    ValidationError:
      type: array
      items:
        type: object
        properties:
          keyword:
            type: string
          dataPath:
            type: string
          params:
            type: string
          message:
            type: string
  securitySchemes:
    api_key:
      type: apiKey
      name: x-apikey
      in: header